#!/usr/bin/env sh
# ============================================================================
# Pre-push Hook for PolliWall (Xterm1)
# ============================================================================
# Runs before pushing to remote to ensure quality. Validates:
# - All unit tests pass
# - Build succeeds
#
# To bypass in emergencies: git push --no-verify
# ============================================================================

echo "ğŸš€ Running pre-push checks..."

# Run unit tests
echo "ğŸ§ª Running unit tests..."
npm test -- --watchAll=false --passWithNoTests
if [ $? -ne 0 ]; then
  echo "âŒ Unit tests failed. Please fix before pushing."
  exit 1
fi
echo "âœ… Unit tests passed"

# Verify build succeeds
echo "ğŸ—ï¸  Verifying build..."
npm run build -- --configuration=production 2>&1 | tail -5
if [ $? -ne 0 ]; then
  echo "âŒ Build failed. Please fix before pushing."
  exit 1
fi
echo "âœ… Build verification passed"

echo "âœ… Pre-push checks passed! Safe to push."
